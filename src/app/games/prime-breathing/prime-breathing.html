<section class="game-section">
  <div class="game-container">
    <header class="game-header">
      <a routerLink="/" class="nav-link">{{ t('back') }}</a>
      <h1 class="game-title">{{ t('title') }}</h1>
      <div class="language-bar" aria-label="{{ t('language') }}">
        <select class="lang-select" [ngModel]="lang" (ngModelChange)="onLanguageChange($event)">
          <option value="en">{{ t('english') }}</option>
          <option value="zh">{{ t('chinese') }}</option>
        </select>
      </div>
    </header>

    <div class="status-bar">
      <div class="hearts" [attr.aria-label]="t('lives')">
        <!-- 状态栏：生命值 -->
        @for(h of [0,1,2]; track $index) {
            <span class="heart" [class.heart-lost]="$index >= lives">❤</span>
        }
      </div>
      <div class="instructions">
        <p class="instruction-text">
          <span class="hint-label">{{ t('ruleLabel') }}</span>
          {{ t('ruleText') }}
        </p>
        <p class="control-hint">{{ t('ruleText2') }}</p>
      </div>
    </div>

    

    <div class="counter-panel">
      <!-- 数字底色，我也许需要给数字给一个底框。 -->
      <div class="counter-value" [class.counter-prime]="isPrimeNow" [class.counter-composite]="!isPrimeNow">{{ count }}</div>

      @if (!hardMode) {
        
        <div class="action-indicator" [class.correct]="isHolding === shouldHold" [class.incorrect]="isHolding !== shouldHold">
          <!-- 动作指示器 -->
          @if (shouldHold) {
            <span class="action-text">{{ t('hold') }}</span>
          } @else {
            <span class="action-text">{{ t('release') }}</span>
          }
        </div>

      } @else {
        <div class="action-indicator" [class.incorrect]="1 === 1">
          <span class="action-text">{{ t('hardModeBadge') }}</span>
        </div>

      }
    </div>

    <div class="overlay-card">
      <!-- 困难模式指示器 -->
      @if (!running) {
        <label class="mode-toggle">
          <input type="checkbox" 
                [(ngModel)]="hardMode" 
                name="hardMode" />
          {{ t('hardModeToggle') }}
        </label>
      }
    </div>

    <div class="controls">
      <!-- 必须支持按空格开始，否则起手会很难受。 -->
      @if (!running && lives === 3 && count === 0) { 
        <p class="control-hint">{{ t('controlHintMobile') }}</p>
      }
    </div>

    @if (!running && lives <= 0) {
      <div class="overlay-card">
        <h2 class="overlay-title">{{ t('gameOverTitle') }}</h2>
        <p class="overlay-text">{{ t('gameOverText') }}</p>
        <p class="control-hint">{{ t('playAgainMobile') }}</p>
      </div>
    }

    <!-- 移动端：按住按钮，始终显示在屏幕底部。 -->
    <div class="mobile-controls">
      <button
        class="hold-button"
        [attr.aria-pressed]="isHolding"
        [attr.draggable]="false"
        (pointerdown)="onPressStart($event)"
        (pointerup)="onPressEnd($event)"
        (pointercancel)="onPressEnd($event)"
        (pointerleave)="onPressEnd($event)"
        (touchstart)="onPressStart($event)"
        (touchend)="onPressEnd($event)"
        (dragstart)="$event.preventDefault()"
        (selectstart)="$event.preventDefault()"
        (contextmenu)="$event.preventDefault()"
      >{{ t('hold') }}</button>
    </div>

  </div>
</section>
